<!doctype html>
<html lang="zh-cn">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.55.4" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>k8s中负载均衡器【ingress-nginx】部署 | 小碗汤的博客</title>
    <meta property="og:title" content="k8s中负载均衡器【ingress-nginx】部署 - 小碗汤的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2019-09-24T10:48:21&#43;08:00">
        
        
    <meta property="article:modified_time" content="2019-09-24T10:48:21&#43;08:00">
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,小碗汤,docker,kubernetes,k8s,java,博客,python,软件架构,公众号,小程序,Hugo,theme,maupassant">
    <meta name="description" content="k8s中负载均衡器【ingress-nginx】部署">
        <meta name="author" content="Liabio">
        
    <meta property="og:url" content="https://liabio.github.io/post/2019-09-24-k8s-loadbalancer-ingress-nginx-deploy/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://liabio.github.io">
                        小碗汤的博客
                    </a>
                
                <p class="description">专注于Java、Go语言(Golang)、Docker、Kubernetes、软件架构</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://liabio.github.io">首页</a>
                    
                    <a  href="https://liabio.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://liabio.github.io/tools/" title="工具">工具</a>
                    
                    <a  href="https://liabio.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">k8s中负载均衡器【ingress-nginx】部署</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2019年9月24日
                        </date>
                        
                        <div class="post-meta">
                            <span>|</span>
                            
                                <span class="meta-category"><a href="https://liabio.github.io/categories/kubernetes">kubernetes</a></span>
                            
                                <span class="meta-category"><a href="https://liabio.github.io/categories/ingress-nginx">ingress-nginx</a></span>
                            
                        </div>
                        
                        
                        <div class="post-meta">
                            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span> 阅读</span></span>
                        </div>
                        
                        
                        <div class="clear">
                            <div class="toc-article">
                                <div class="toc-title">文章目录</div>
                                <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#前言">前言</a></li>
<li><a href="#image-https-imgconvert-csdnimg-cn-ahr0chm6ly91cgxvywqtaw1hz2vzlmppyw5zahuuaw8vdxbsb2fkx2ltywdlcy85mtm0nzyzltyzztrkmdc2owm2mguyody"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy85MTM0NzYzLTYzZTRkMDc2OWM2MGUyODY" alt="image" /></a>
<ul>
<li>
<ul>
<li><a href="#ingress-组成">Ingress 组成？</a></li>
<li><a href="#ingress-工作原理">Ingress 工作原理?</a></li>
<li><a href="#ingress-可以解决什么问题">Ingress 可以解决什么问题？</a>
<ul>
<li><a href="#动态配置服务">动态配置服务</a></li>
<li><a href="#减少不必要的端口暴露">减少不必要的端口暴露</a></li>
</ul></li>
<li><a href="#ingress当前的实现方式">Ingress当前的实现方式？</a></li>
</ul></li>
<li><a href="#ingress-nginx-controller">ingress-nginx-controller</a></li>
<li><a href="#参考">参考：</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
                            </div>
                        </div>
                        
                        <div class="post-content">
                            

<h2 id="前言">前言</h2>

<p>本文首发于公众号【我的小碗汤】<strong>本公众号</strong>免费<strong>提供csdn下载服务，海量IT学习资源，</strong>如果你准备入IT坑，励志成为优秀的程序猿，那么这些资源很适合你，包括但不限于java、go、python、springcloud、elk、嵌入式 、大数据、面试资料、前端 等资源。扫码关注：</p>

<h2 id="image-https-imgconvert-csdnimg-cn-ahr0chm6ly91cgxvywqtaw1hz2vzlmppyw5zahuuaw8vdxbsb2fkx2ltywdlcy85mtm0nzyzltyzztrkmdc2owm2mguyody"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy85MTM0NzYzLTYzZTRkMDc2OWM2MGUyODY" alt="image" /></h2>

<p>在Kubernetes中，服务和Pod的IP地址仅可以在集群网络内部使用，对于集群外的应用是不可见的。为了使外部的应用能够访问集群内的服务，在Kubernetes 目前 提供了以下几种方案：</p>

<ul>
<li><p>NodePort</p></li>

<li><p>LoadBalancer</p></li>

<li><p>Ingress</p></li>
</ul>

<p>本节主要就ingress和ingress控制器ingress-nginx-controller的部署作简单介绍和记录。</p>

<p><strong>以下系统组件版本：</strong></p>

<p>云服务器：centos版本7.6.1810、k8s版本1.15.0、docker版本18.06.1-ce、ingress-nginx-controller版本0.25.0</p>

<p>Ingress</p>

<h4 id="ingress-组成">Ingress 组成？</h4>

<ul>
<li><p>将Nginx的配置抽象成一个Ingress对象，每添加一个新的服务只需写一个新的Ingress的yaml文件即可</p></li>

<li><p>将新加入的Ingress转化成Nginx的配置文件并使之生效</p></li>

<li><p>ingress controller</p></li>

<li><p>ingress服务</p></li>
</ul>

<h4 id="ingress-工作原理">Ingress 工作原理?</h4>

<ul>
<li>ingress controller通过和kubernetes api交互，动态的去感知集群中ingress规则变化，</li>
<li>然后读取它，按照自定义的规则，规则就是写明了哪个域名对应哪个service，生成一段nginx配置，</li>
<li>再写到nginx-ingress-controller的pod里，这个Ingress
controller的pod里运行着一个Nginx服务，控制器会把生成的nginx配置写入/etc/nginx.conf文件中，</li>
<li>然后reload一下使配置生效。以此达到域名分配置和动态更新的问题。</li>
</ul>

<h4 id="ingress-可以解决什么问题">Ingress 可以解决什么问题？</h4>

<h5 id="动态配置服务">动态配置服务</h5>

<p>如果按照传统方式, 当新增加一个服务时, 我们可能需要在流量入口加一个反向代理指向我们新的服务. 而如果用了Ingress, 只需要配置好这个服务, 当服务启动时, 会自动注册到Ingress的中, 不需要而外的操作.</p>

<h5 id="减少不必要的端口暴露">减少不必要的端口暴露</h5>

<p>配置过k8s的都清楚, 第一步是要关闭防火墙的, 主要原因是k8s的很多服务会以NodePort方式映射出去, 这样就相当于给宿主机打了很多孔, 既不安全也不优雅. 而Ingress可以避免这个问题, 除了Ingress自身服务可能需要映射出去, 其他服务都不要用NodePort方式</p>

<h4 id="ingress当前的实现方式">Ingress当前的实现方式？</h4>

<p><img src="https://img-blog.csdnimg.cn/20190715000825125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saWFiaW8uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>

<h3 id="ingress-nginx-controller">ingress-nginx-controller</h3>

<p>目前最新版本的ingress-nginx-controller，用lua实现了当upstream变化时不用reload，大大减少了生产环境中由于服务的重启、升级引起的IP变化导致的nginx reload。</p>

<p>以下就ingress-nginx-controller的部署做简单记录：</p>

<p>yaml如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>{如下文件}</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml">apiVersion<span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>Namespace<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>--<span class="sd">-
</span><span class="sd">
</span><span class="sd">kind: ConfigMap</span><span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-configuration<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>ConfigMap<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>tcp-services<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>ConfigMap<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>udp-services<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>ServiceAccount<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-serviceaccount<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>rbac.authorization.k8s.io/v1beta1<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>ClusterRole<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-clusterrole<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w"></span>rules<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>configmaps<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>endpoints<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>nodes<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>pods<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>secrets<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>list<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>watch<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>nodes<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>get<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>services<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>get<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>list<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>watch<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>events<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>create<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>patch<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;extensions&#34;</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;networking.k8s.io&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>ingresses<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>get<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>list<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>watch<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;extensions&#34;</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;networking.k8s.io&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>ingresses/status<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>update<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>rbac.authorization.k8s.io/v1beta1<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>Role<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-role<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w"></span>rules<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>configmaps<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>pods<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>secrets<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>namespaces<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>get<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>configmaps<span class="w">
</span><span class="w">    </span>resourceNames<span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c"># Defaults to &#34;&lt;election-id&gt;-&lt;ingress-class&gt;&#34;</span><span class="w">
</span><span class="w">      </span><span class="c"># Here: &#34;&lt;ingress-controller-leader&gt;-&lt;nginx&gt;&#34;</span><span class="w">
</span><span class="w">      </span><span class="c"># This has to be adapted if you change either parameter</span><span class="w">
</span><span class="w">      </span><span class="c"># when launching the nginx-ingress-controller.</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;ingress-controller-leader-nginx&#34;</span><span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>get<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>update<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>configmaps<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>create<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>apiGroups<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">    </span>resources<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>endpoints<span class="w">
</span><span class="w">    </span>verbs<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>get<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>rbac.authorization.k8s.io/v1beta1<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>RoleBinding<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-role-nisa-binding<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w"></span>roleRef<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiGroup<span class="p">:</span><span class="w"> </span>rbac.authorization.k8s.io<span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Role<span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-role<span class="w">
</span><span class="w"></span>subjects<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>kind<span class="p">:</span><span class="w"> </span>ServiceAccount<span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-serviceaccount<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>---<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>rbac.authorization.k8s.io/v1beta1<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>ClusterRoleBinding<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-clusterrole-nisa-binding<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w"></span>roleRef<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiGroup<span class="p">:</span><span class="w"> </span>rbac.authorization.k8s.io<span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>ClusterRole<span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-clusterrole<span class="w">
</span><span class="w"></span>subjects<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>kind<span class="p">:</span><span class="w"> </span>ServiceAccount<span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-serviceaccount<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">
</span><span class="w"></span>--<span class="sd">-
</span><span class="sd">
</span><span class="sd">apiVersion: apps/v1</span><span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>Deployment<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-controller<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w"></span>spec<span class="p">:</span><span class="w">
</span><span class="w">  </span>replicas<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span>selector<span class="p">:</span><span class="w">
</span><span class="w">    </span>matchLabels<span class="p">:</span><span class="w">
</span><span class="w">      </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">      </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>template<span class="p">:</span><span class="w">
</span><span class="w">    </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">      </span>labels<span class="p">:</span><span class="w">
</span><span class="w">        </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">        </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">      </span>annotations<span class="p">:</span><span class="w">
</span><span class="w">        </span>prometheus.io/port<span class="p">:</span><span class="w"> </span><span class="s2">&#34;10254&#34;</span><span class="w">
</span><span class="w">        </span>prometheus.io/scrape<span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">    </span>spec<span class="p">:</span><span class="w">
</span><span class="w">      </span>serviceAccountName<span class="p">:</span><span class="w"> </span>nginx-ingress-serviceaccount<span class="w">
</span><span class="w">      </span>containers<span class="p">:</span><span class="w">
</span><span class="w">        </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>nginx-ingress-controller<span class="w">
</span><span class="w">          </span>image<span class="p">:</span><span class="w"> </span>quay.io/kubernetes-ingress-controller/nginx-ingress-controller<span class="p">:</span><span class="m">0.25</span>.<span class="m">0</span><span class="w">
</span><span class="w">          </span>args<span class="p">:</span><span class="w">
</span><span class="w">            </span>-<span class="w"> </span>/nginx-ingress-controller<span class="w">
</span><span class="w">            </span>-<span class="w"> </span>--configmap=$(POD_NAMESPACE)/nginx-configuration<span class="w">
</span><span class="w">            </span>-<span class="w"> </span>--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services<span class="w">
</span><span class="w">            </span>-<span class="w"> </span>--udp-services-configmap=$(POD_NAMESPACE)/udp-services<span class="w">
</span><span class="w">            </span>-<span class="w"> </span>--publish-service=$(POD_NAMESPACE)/ingress-nginx<span class="w">
</span><span class="w">            </span>-<span class="w"> </span>--annotations-prefix=nginx.ingress.kubernetes.io<span class="w">
</span><span class="w">          </span>securityContext<span class="p">:</span><span class="w">
</span><span class="w">            </span>allowPrivilegeEscalation<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">            </span>capabilities<span class="p">:</span><span class="w">
</span><span class="w">              </span>drop<span class="p">:</span><span class="w">
</span><span class="w">                </span>-<span class="w"> </span>ALL<span class="w">
</span><span class="w">              </span>add<span class="p">:</span><span class="w">
</span><span class="w">                </span>-<span class="w"> </span>NET_BIND_SERVICE<span class="w">
</span><span class="w">            </span><span class="c"># www-data -&gt; 33</span><span class="w">
</span><span class="w">            </span>runAsUser<span class="p">:</span><span class="w"> </span><span class="m">33</span><span class="w">
</span><span class="w">          </span>env<span class="p">:</span><span class="w">
</span><span class="w">            </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>POD_NAME<span class="w">
</span><span class="w">              </span>valueFrom<span class="p">:</span><span class="w">
</span><span class="w">                </span>fieldRef<span class="p">:</span><span class="w">
</span><span class="w">                  </span>fieldPath<span class="p">:</span><span class="w"> </span>metadata.name<span class="w">
</span><span class="w">            </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>POD_NAMESPACE<span class="w">
</span><span class="w">              </span>valueFrom<span class="p">:</span><span class="w">
</span><span class="w">                </span>fieldRef<span class="p">:</span><span class="w">
</span><span class="w">                  </span>fieldPath<span class="p">:</span><span class="w"> </span>metadata.namespace<span class="w">
</span><span class="w">          </span>ports<span class="p">:</span><span class="w">
</span><span class="w">            </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>http<span class="w">
</span><span class="w">              </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">            </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>https<span class="w">
</span><span class="w">              </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span><span class="w">          </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">            </span>failureThreshold<span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">            </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">              </span>path<span class="p">:</span><span class="w"> </span>/healthz<span class="w">
</span><span class="w">              </span>port<span class="p">:</span><span class="w"> </span><span class="m">10254</span><span class="w">
</span><span class="w">              </span>scheme<span class="p">:</span><span class="w"> </span>HTTP<span class="w">
</span><span class="w">            </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">            </span>periodSeconds<span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">            </span>successThreshold<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">            </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">          </span>readinessProbe<span class="p">:</span><span class="w">
</span><span class="w">            </span>failureThreshold<span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">            </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">              </span>path<span class="p">:</span><span class="w"> </span>/healthz<span class="w">
</span><span class="w">              </span>port<span class="p">:</span><span class="w"> </span><span class="m">10254</span><span class="w">
</span><span class="w">              </span>scheme<span class="p">:</span><span class="w"> </span>HTTP<span class="w">
</span><span class="w">            </span>periodSeconds<span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">            </span>successThreshold<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">            </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">
</span><span class="w"></span>---</code></pre></td></tr></table>
</div>
</div>
<p>在墙内会拉取不到以下镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.25.0</pre></td></tr></table>
</div>
</div>
<p>可以使用国内阿里云镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/nginx-ingress-controller:0.25.0</pre></td></tr></table>
</div>
</div>
<p>安装后，在ingress-nginx命名空间下可以看到pod一直pending，describe pod报如下警告：</p>

<p><img src="https://img-blog.csdnimg.cn/20190715000810584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saWFiaW8uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>

<p>查看master节点默认加了污点，一般不允许pod调度到master节点：</p>

<p><img src="https://img-blog.csdnimg.cn/2019071500080638.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saWFiaW8uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>

<p>如果k8s集群只有一个节点，可以在pod的spec下设置容忍该污点：</p>

<p><img src="https://img-blog.csdnimg.cn/20190715000758386.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saWFiaW8uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>

<p>即：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">   </span>spec<span class="p">:</span><span class="w">      
</span><span class="w">      </span>tolerations<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>effect<span class="p">:</span><span class="w"> </span>NoSchedule<span class="w">
</span><span class="w">        </span>key<span class="p">:</span><span class="w"> </span>node-role.kubernetes.io/master</code></pre></td></tr></table>
</div>
</div>
<p>可以看到ingress-nginx pod被调度到master节点，且变为Running</p>

<p><img src="https://img-blog.csdnimg.cn/20190715000750440.png" alt="在这里插入图片描述" /></p>

<p>看日志报以下警告：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">W0714 <span class="m">13</span>:31:04.883127       <span class="m">6</span> queue.go:130<span class="o">]</span> requeuing <span class="p">&amp;</span>ObjectMeta<span class="o">{</span>Name:sync status,GenerateName:,Namespace:,SelfLink:,UID:,ResourceVersion:,Generation:0,CreationTimestamp:0001-01-01 <span class="m">00</span>:00:00 +0000 UTC,DeletionTimestamp:&lt;nil&gt;,DeletionGracePeriodSeconds:nil,Labels:map<span class="o">[</span>string<span class="o">]</span>string<span class="o">{}</span>,Annotations:map<span class="o">[</span>string<span class="o">]</span>string<span class="o">{}</span>,OwnerReferences:<span class="o">[]</span>,Finalizers:<span class="o">[]</span>,ClusterName:,Initializers:nil,ManagedFields:<span class="o">[]</span>,<span class="o">}</span>, err services <span class="s2">&#34;ingress-nginx&#34;</span> not found</code></pre></td></tr></table>
</div>
</div>
<p>需要创一个名为ingress-nginx的service：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml">kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>{如下文件}<span class="w">
</span><span class="w"></span>kind<span class="p">:</span><span class="w"> </span>Service<span class="w">
</span><span class="w"></span>apiVersion<span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span>metadata<span class="p">:</span><span class="w">
</span><span class="w">  </span>name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>namespace<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>labels<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w"></span>spec<span class="p">:</span><span class="w">
</span><span class="w">  </span>externalTrafficPolicy<span class="p">:</span><span class="w"> </span>Local<span class="w">
</span><span class="w">  </span>type<span class="p">:</span><span class="w"> </span>LoadBalancer<span class="w">
</span><span class="w">  </span>selector<span class="p">:</span><span class="w">
</span><span class="w">    </span>app.kubernetes.io/name<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">    </span>app.kubernetes.io/part-of<span class="p">:</span><span class="w"> </span>ingress-nginx<span class="w">
</span><span class="w">  </span>ports<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>http<span class="w">
</span><span class="w">      </span>port<span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">      </span>targetPort<span class="p">:</span><span class="w"> </span>http<span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>https<span class="w">
</span><span class="w">      </span>port<span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span><span class="w">      </span>targetPort<span class="p">:</span><span class="w"> </span>https</code></pre></td></tr></table>
</div>
</div>
<h3 id="参考">参考：</h3>

<p><strong>ingress deploy</strong></p>

<p><a href="https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md">https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md</a></p>

<p><strong>Taint和Toleration（污点和容忍）</strong></p>

<p><a href="https://jimmysong.io/kubernetes-handbook/concepts/taint-and-toleration.html">https://jimmysong.io/kubernetes-handbook/concepts/taint-and-toleration.html</a></p>

<p><strong>k8s 1.12部署ingress-nginx</strong></p>

<p><a href="https://www.jianshu.com/p/e30b06906b77">https://www.jianshu.com/p/e30b06906b77</a></p>

<hr />

<hr />

<p><strong>本公众号</strong>免费<strong>提供csdn下载服务，海量IT学习资源，</strong>如果你准备入IT坑，励志成为优秀的程序猿，那么这些资源很适合你，包括但不限于java、go、python、springcloud、elk、嵌入式 、大数据、面试资料、前端 等资源。同时我们组建了一个技术交流群，里面有很多大佬，会不定时分享技术文章，如果你想来一起学习提高，可以公众号后台回复【<strong>2</strong>】，免费邀请加技术交流群互相学习提高，会不定期分享编程IT相关资源。</p>

<hr />

<p>扫码关注，精彩内容第一时间推给你</p>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy85MTM0NzYzLTE2YjU5M2MyZjVjM2VmOGY" alt="image" /></p>

                        </div>

                        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://liabio.github.io">小碗汤</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://liabio.github.io/post/2019-09-24-k8s-loadbalancer-ingress-nginx-deploy/">https://liabio.github.io/post/2019-09-24-k8s-loadbalancer-ingress-nginx-deploy/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/2019-09-24-k8s-job-execute-fail-do-what/">k8s使用Job执行任务失败了怎么办</a></li>
        
        <li><a href="/post/2019-09-24-k8s-domain-resolve-coredns-problem-debug/">采坑指南——k8s域名解析coredns问题排查过程</a></li>
        
        <li><a href="/post/2019-09-24-docker-image-essential-skills/">docker镜像制作必备技能</a></li>
        
        <li><a href="/post/2019-09-24-kubernetes-gc-GarbageCollector-Controller-source-one/">docker镜像制作必备技能</a></li>
        
        <li><a href="/post/2019-09-24-docker-create-svc-in-cloudserver/">一次socket.error: [Errno 99] Cannot assign requested address报错排查</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://liabio.github.io/tags/kubernetes">kubernetes</a></li>
                                
                                <li><a href="https://liabio.github.io/tags/ingress-nginx">ingress-nginx</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-liabio-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "liabio/utteranc_comment"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://liabio.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-docker-image-essential-skills/" title="docker镜像制作必备技能">docker镜像制作必备技能</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-kubernetes-gc-GarbageCollector-Controller-source-one/" title="docker镜像制作必备技能">docker镜像制作必备技能</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-k8s-loadbalancer-ingress-nginx-deploy/" title="k8s中负载均衡器【ingress-nginx】部署">k8s中负载均衡器【ingress-nginx】部署</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-k8s-job-execute-fail-do-what/" title="k8s使用Job执行任务失败了怎么办">k8s使用Job执行任务失败了怎么办</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-docker-create-svc-in-cloudserver/" title="一次socket.error: [Errno 99] Cannot assign requested address报错排查">一次socket.error: [Errno 99] Cannot assign requested address报错排查</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-socket-error-debug/" title="云服务器使用docker搭建服务">云服务器使用docker搭建服务</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-docker-comprehensive-knowledge/" title="史上最全docker基础知识汇总">史上最全docker基础知识汇总</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-09-24-k8s-domain-resolve-coredns-problem-debug/" title="采坑指南——k8s域名解析coredns问题排查过程">采坑指南——k8s域名解析coredns问题排查过程</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-05-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAkubernetes%E9%9B%86%E7%BE%A4/" title="手把手教你搭建kubernetes集群.md">手把手教你搭建kubernetes集群.md</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/post/2019-05-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAkubernetes%E9%9B%86%E7%BE%A41/" title="手把手教你搭建kubernetes集群1">手把手教你搭建kubernetes集群1</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=jdg9oj97" title="领取￥1888阿里云产品通用代金券" target="_blank" style="color:red">
                
                    领取￥1888阿里云产品通用代金券
                
            </a>
        </li>
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/act/vmpt/aliyun-group/home.html?userCode=jdg9oj97" title="领取￥1888阿里云产品通用代金券" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB17qJhXpzqK1RjSZFvXXcB7VXa-200-126.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/act/enterprise-discount.html?userCode=jdg9oj97" title="领取￥1888阿里云产品通用代金券" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1aDXhXpzqK1RjSZFvXXcB7VXa-259-194.jpg">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://liabio.github.io/categories/Blog/">Blog(1)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/Kubernetes/">Kubernetes(4)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/debug/">debug(1)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/docker/">docker(6)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/ingress-nginx/">ingress-nginx(1)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/job/">job(2)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/k8s/">k8s(1)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/kubernetes/">kubernetes(3)</a>
    </li>
    
    <li>
        <a href="https://liabio.github.io/categories/%E5%B7%A5%E5%85%B7/">工具(1)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://liabio.github.io/tags/Blog/">Blog</a>
    
    <a href="https://liabio.github.io/tags/Golang/">Golang</a>
    
    <a href="https://liabio.github.io/tags/Hugo/">Hugo</a>
    
    <a href="https://liabio.github.io/tags/Kubernetes/">Kubernetes</a>
    
    <a href="https://liabio.github.io/tags/Scheduler/">Scheduler</a>
    
    <a href="https://liabio.github.io/tags/docker/">docker</a>
    
    <a href="https://liabio.github.io/tags/ingress-nginx/">ingress-nginx</a>
    
    <a href="https://liabio.github.io/tags/kubernetes/">kubernetes</a>
    
    <a href="https://liabio.github.io/tags/%E5%AE%B9%E5%99%A8/">容器</a>
    
    <a href="https://liabio.github.io/tags/%E5%B7%A5%E5%85%B7/">工具</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="http://yuedu.baidu.com/ebook/14a722970740be1e640e9a3e" title="Android Gradle权威指南">Android Gradle权威指南</a>
        </li>
        
        <li>
            <a target="_blank" href="http://mirrors.flysnow.org/" title="常用开发工具CDN镜像">常用开发工具CDN镜像</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://liabio.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2019 <a href="https://liabio.github.io">小碗汤的博客 By 小碗汤</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139517579-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>
</html>
