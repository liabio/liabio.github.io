<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on LeaveIt</title>
    <link>https://liabio.github.io/post/</link>
    <description>Recent content in Posts on LeaveIt</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 24 Sep 2019 10:48:21 +0800</lastBuildDate>
    
	<atom:link href="https://liabio.github.io/post/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>dockeré•œåƒåˆ¶ä½œå¿…å¤‡æŠ€èƒ½</title>
      <link>https://liabio.github.io/post/2019-09-24-docker-image-essential-skills/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-docker-image-essential-skills/</guid>
      <description>å‰è¨€ æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ã€æˆ‘çš„å°ç¢—æ±¤ã€‘æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚æ‰«ç å…³æ³¨ï¼š
æ­£æ–‡ ä½¿ç”¨è¿‡dockerçš„éƒ½çŸ¥é“dockerfileï¼Œå…¶ç”¨äºå®šä¹‰åˆ¶ä½œé•œåƒçš„æµç¨‹ï¼Œç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œè¿™äº›å‘½ä»¤åº”ç”¨äºåŸºç¡€é•œåƒå¹¶æœ€ç»ˆåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚å¯å‚è€ƒå¾€æœŸæ–‡ç« å­¦ä¹ ï¼šdockeråŸºç¡€çŸ¥è¯†æ•´ç†
æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åœ¨åŸæœ‰é•œåƒåŸºç¡€ä¸Šä¿®æ”¹ã€å¢åŠ æ–‡ä»¶ï¼Œç”±äºå›½å†…ç½‘ç»œåŸå› ï¼Œé‡æ–°åˆ¶ä½œé•œåƒä¼šå¾ˆæ…¢ï¼Œç”šè‡³å¤±è´¥ï¼›æˆ–è€…æ ¹æœ¬ä¸çŸ¥é“é•œåƒçš„dockerfileé•¿ä»€ä¹ˆæ ·ã€‚æ”¹åŠ¨å¾ˆå°æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼åˆ¶ä½œé•œåƒã€‚
æ‹¿k8sè´Ÿè½½å‡è¡¡å™¨ç»„ä»¶ingress-nginx:0.24.1ç‰ˆæœ¬ä¸ºä¾‹ï¼š å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†å…¶æºç ï¼Œå¹¶ç¼–è¯‘ç”Ÿæˆnginx-ingress-controlleräºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡Œåˆ¶ä½œæ–°é•œåƒã€‚
é¦–å…ˆç”¨å‘½ä»¤ï¼š
docker run -ti --rm k8s-deploy/nginx-ingress-controller:0.24.1 bash  å°†é•œåƒè¿è¡Œèµ·æ¥ã€‚å…¶ä¸­-tiè¡¨ç¤ºæ‰“å¼€ä¸€ä¸ªäº¤äº’è¾“å…¥ç»ˆç«¯ï¼›&amp;ndash;rmè¡¨ç¤ºè¿è¡Œåœæ­¢åè‡ªåŠ¨æ¸…ç†ã€‚
è¿è¡Œåå¯ä»¥çœ‹åˆ°é»˜è®¤ç”¨æˆ·ä¸ºwww-dataï¼Œa298fe62a4f9è¡¨ç¤ºå®¹å™¨id æˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨é‡Œåˆ›å»ºç›®å½•ï¼š é‡æ–°æ‰“å¼€ä¸€ä¸ªshellçª—å£ï¼Œç”¨äºç»™å®¹å™¨å†…å¤åˆ¶ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼š
docker cp ingressgroup-upstream.tmpl a298fe62a4f9:/etc/nginx/conf.d/include-server-map/  å¤åˆ¶è¿›å»åï¼Œå½“è¦å°†å…¶ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®æ—¶ï¼ŒæŠ¥Permission deniedæƒé™ä¸è¶³ï¼Œå› ä¸ºé»˜è®¤ä¸ºwww-dataç”¨æˆ·ï¼Œå¤åˆ¶åˆ°å®¹å™¨å†…çš„ingressgroup-upstream.tmplå±ä¸»:å±ç»„ä¹Ÿæ˜¯rootï¼Œå¦‚æœä¸æŠŠrootä¿®æ”¹ä¸ºwww-dataï¼Œè‚¯å®šä¼šæŠ¥æ²¡æƒé™çš„é”™ã€‚
é€šè¿‡ä»¥ä¸‹å‘½ä»¤é‡æ–°è¿è¡Œé•œåƒï¼š
docker run -ti --rm -u 0 k8s-deploy/nginx-ingress-controller:0.24.1 bash  -u 0ä»£è¡¨ç”¨rootç”¨æˆ·è¿è¡Œå®¹å™¨ï¼Œè€Œä¸æ˜¯dockerfileé‡ŒæŒ‡å®šçš„ç”¨æˆ·ï¼Œè¿™æ ·è¿è¡Œåå¯ä»¥çœ‹åˆ°ç”¨æˆ·ä¸ºrootï¼Œè®°å½•å®¹å™¨id:ffdc80f3cce7
é‡æ–°æ‰§è¡Œå¤åˆ¶æ“ä½œï¼š
æ­¤æ—¶å°±å¯ä»¥éšæ„ç§»åŠ¨å’Œä¿®æ”¹æ–‡ä»¶çš„æƒé™ã€å±ç»„ã€å±ä¸»äº†ã€‚
ä¿®æ”¹å®Œæ¯•åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†é•œåƒcommitåˆ°æœ¬åœ°ä»“åº“ï¼š
docker commit ffdc80f3cce7 k8s-deploy/nginx-ingress-controller:0.24.1-temp  commitåè·Ÿçš„æ˜¯å®¹å™¨idï¼Œæœ€åè·Ÿçš„æ˜¯æ–°é•œåƒåç§°ã€‚pushå‘½ä»¤å°†æ–°é•œåƒæ¨åˆ°è¿œç¨‹harborä»“åº“ã€‚
è¿è¡Œæ–°åˆ¶ä½œçš„é•œåƒï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¿®æ”¹çš„æ–‡ä»¶ã€‚
è¿™ç§æ–¹å¼ä¸€èˆ¬ç”¨äºæµ‹è¯•ï¼Œå¼Šç«¯æ˜¯å¯èƒ½ä¼šå¯¼è‡´é•œåƒè¶Šæ¥è¶Šå¤§ã€‚
æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚åŒæ—¶æˆ‘ä»¬ç»„å»ºäº†ä¸€ä¸ªæŠ€æœ¯äº¤æµç¾¤ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå¤§ä½¬ï¼Œä¼šä¸å®šæ—¶åˆ†äº«æŠ€æœ¯æ–‡ç« ï¼Œå¦‚æœä½ æƒ³æ¥ä¸€èµ·å­¦ä¹ æé«˜ï¼Œå¯ä»¥å…¬ä¼—å·åå°å›å¤ã€2ã€‘ï¼Œå…è´¹é‚€è¯·åŠ æŠ€æœ¯äº¤æµç¾¤äº’ç›¸å­¦ä¹ æé«˜ï¼Œä¼šä¸å®šæœŸåˆ†äº«ç¼–ç¨‹ITç›¸å…³èµ„æºã€‚
æ‰«ç å…³æ³¨ï¼Œç²¾å½©å†…å®¹ç¬¬ä¸€æ—¶é—´æ¨ç»™ä½ </description>
    </item>
    
    <item>
      <title>dockeré•œåƒåˆ¶ä½œå¿…å¤‡æŠ€èƒ½</title>
      <link>https://liabio.github.io/post/2019-09-24-kubernetes-gc-garbagecollector-controller-source-one/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-kubernetes-gc-garbagecollector-controller-source-one/</guid>
      <description>kubernetesç‰ˆæœ¬ï¼š1.13.2
 èƒŒæ™¯ ç”±äºoperatoråˆ›å»ºçš„redisé›†ç¾¤ï¼Œåœ¨kubernetes apiserveré‡å¯åï¼Œredisé›†ç¾¤è¢«å¼‚å¸¸åˆ é™¤ï¼ˆåŒ…æ‹¬redis exporter statefulsetã€redis statefulsetï¼‰ã€‚åˆ é™¤åoperatorå°†å…¶é‡å»ºï¼Œé‡æ–°ç»„å»ºé›†ç¾¤ï¼Œå®ä¾‹IPå‘ç”Ÿå˜æ›´ï¼ˆä¸­é—´ä»¶å®¹å™¨åŒ–ï¼Œæˆ‘ä»¬å¼€å‘äº†å›ºå®šIPï¼Œå½“statefulsetåˆ é™¤åï¼ŒIPä¼šè¢«å›æ”¶ï¼‰ï¼Œå¯¼è‡´åˆ›å»ºé›†ç¾¤å¤±è´¥ï¼Œæœ€ç»ˆé›†ç¾¤ä¸å¯ç”¨ã€‚
ç»å¤šæ¬¡å¤ç°ï¼Œapiserveré‡å¯åï¼Œé€šè¿‡æŸ¥è¯¢redis operatoræ—¥å¿—ï¼Œå¹¶æ²¡æœ‰å‘ç°ä¸»åŠ¨å»åˆ é™¤redisé›†ç¾¤ï¼ˆredis statefulsetï¼‰ã€ç›‘æ§å®ä¾‹ï¼ˆredis exporterï¼‰ã€‚è¿›ä¸€æ­¥å»æŸ¥çœ‹kube-controller-managerçš„æ—¥å¿—ï¼Œå°†å…¶æ—¥å¿—çº§åˆ«è®¾ç½®&amp;ndash;v=5ï¼Œç»§ç»­å¤ç°ï¼Œæœ€ç»ˆåœ¨kube-controller-manageræ—¥å¿—ä¸­å‘ç°å¦‚ä¸‹æ—¥å¿—ï¼š å¯ä»¥çœ‹åˆ°æ˜¯garbage collectorè§¦å‘åˆ é™¤æ“ä½œçš„ã€‚è¿™ä¸ªé—®é¢˜åœ¨apiserveræ­£å¸¸çš„æ—¶å€™æ˜¯ä¸å­˜åœ¨ï¼Œè¦æƒ³å¼„å…¶ç©¶ç«Ÿï¼Œå°±å¾—çœ‹çœ‹kube-controller-managerå†…ç½®ç»„ä»¶garbage collectorè¿™ä¸ªæ§åˆ¶å™¨çš„é€»è¾‘ã€‚
ç”±äºå†…å®¹åé•¿ï¼Œåˆ†ä¸ºå¤šèŠ‚æ¥è®²ï¼š â‘ ã€monitorsä½œä¸ºç”Ÿäº§è€…å°†å˜åŒ–çš„èµ„æºæ”¾å…¥graphChangesé˜Ÿåˆ—ï¼›åŒæ—¶restMapperå®šæœŸæ£€æµ‹é›†ç¾¤å†…èµ„æºç±»å‹ï¼Œåˆ·æ–°monitors â‘¡ã€runProcessGraphChangesä»graphChangesé˜Ÿåˆ—ä¸­å–å‡ºå˜åŒ–çš„itemï¼Œæ ¹æ®æƒ…å†µæ”¾å…¥attemptToDeleteé˜Ÿåˆ—ï¼›runAttemptToDeleteWorkerå–å‡ºå¤„ç†åƒåœ¾èµ„æºï¼› â‘¢ã€runProcessGraphChangesä»graphChangesé˜Ÿåˆ—ä¸­å–å‡ºå˜åŒ–çš„itemï¼Œæ ¹æ®æƒ…å†µæ”¾å…¥attemptToOrphané˜Ÿåˆ—ï¼›runAttemptToOrphanWorkerå–å‡ºå¤„ç†è¯¥è¯¥å­¤ç«‹çš„èµ„æºï¼› æ­£æ–‡ æƒ³è¦å¯ç”¨GCï¼Œéœ€è¦åœ¨kube-apiserverå’Œkube-controller-managerçš„å¯åŠ¨å‚æ•°ä¸­éƒ½è®¾ç½®--enable-garbage-collectorä¸ºtrue,1.13.2ç‰ˆæœ¬ä¸­é»˜è®¤å¼€å¯GCã€‚
éœ€è¦æ³¨æ„ï¼šä¸¤ç»„ä»¶è¯¥å‚æ•°å¿…é¡»ä¿æŒåŒæ­¥ã€‚
kube-controller-managerå¯åŠ¨å…¥å£ï¼Œapp.NewControllerManagerCommand()ä¸­åŠ è½½controller manageré»˜è®¤å¯åŠ¨å‚æ•°ï¼Œåˆ›å»º* cobra.Commandå¯¹è±¡ï¼š
func main() { rand.Seed(time.Now().UnixNano()) //åŠ è½½controller manageré»˜è®¤å¯åŠ¨å‚æ•°ï¼Œåˆ›å»º* cobra.Commandå¯¹è±¡ command := app.NewControllerManagerCommand() //......çœç•¥....... //æ‰§è¡Œcobra.commandï¼Œå¹¶å¯åŠ¨controller-manager if err := command.Execute(); err != nil { fmt.Fprintf(os.Stderr, &amp;quot;%v\n&amp;quot;, err) os.Exit(1) } }  ä»¥ä¸‹ä»£ç å¤„å»å¯åŠ¨kube-controller-managerï¼š NewDefaultComponentConfig(ports.InsecureKubeControllerManagerPort)åŠ è½½å„ä¸ªæ§åˆ¶å™¨çš„é…ç½®ï¼š
//NewKubeControllerManagerOptionsä½¿ç”¨é»˜è®¤é…ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„KubeControllerManagerOptions func NewKubeControllerManagerOptions() (*KubeControllerManagerOptions, error) { //åŠ è½½å„ä¸ªæ§åˆ¶å™¨çš„é»˜è®¤é…ç½® componentConfig, err := NewDefaultComponentConfig(ports.InsecureKubeControllerManagerPort) if err != nil { return nil, err } s := KubeControllerManagerOptions{ Generic: cmoptions.</description>
    </item>
    
    <item>
      <title>gitå¸¸ç”¨æ“ä½œ</title>
      <link>https://liabio.github.io/post/2019-09-24-git-operator-command/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-git-operator-command/</guid>
      <description> è§£å†³git pull/pushæ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç é—®é¢˜ git config --global credential.helper store  gitè¾“å…¥æ­£ç¡®å¯†ç åè¿˜æ˜¯æç¤ºé”™è¯¯è§£å†³ git config --system --unset credential.helper  fatal: unable to get credential storage lock: File exists </description>
    </item>
    
    <item>
      <title>k8sä¸­è´Ÿè½½å‡è¡¡å™¨ã€ingress-nginxã€‘éƒ¨ç½²</title>
      <link>https://liabio.github.io/post/2019-09-24-k8s-loadbalancer-ingress-nginx-deploy/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-k8s-loadbalancer-ingress-nginx-deploy/</guid>
      <description>å‰è¨€ æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ã€æˆ‘çš„å°ç¢—æ±¤ã€‘æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚æ‰«ç å…³æ³¨ï¼š
 åœ¨Kubernetesä¸­ï¼ŒæœåŠ¡å’ŒPodçš„IPåœ°å€ä»…å¯ä»¥åœ¨é›†ç¾¤ç½‘ç»œå†…éƒ¨ä½¿ç”¨ï¼Œå¯¹äºé›†ç¾¤å¤–çš„åº”ç”¨æ˜¯ä¸å¯è§çš„ã€‚ä¸ºäº†ä½¿å¤–éƒ¨çš„åº”ç”¨èƒ½å¤Ÿè®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼Œåœ¨Kubernetes ç›®å‰ æä¾›äº†ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š
 NodePort
 LoadBalancer
 Ingress
  æœ¬èŠ‚ä¸»è¦å°±ingresså’Œingressæ§åˆ¶å™¨ingress-nginx-controllerçš„éƒ¨ç½²ä½œç®€å•ä»‹ç»å’Œè®°å½•ã€‚
ä»¥ä¸‹ç³»ç»Ÿç»„ä»¶ç‰ˆæœ¬ï¼š
äº‘æœåŠ¡å™¨ï¼šcentosç‰ˆæœ¬7.6.1810ã€k8sç‰ˆæœ¬1.15.0ã€dockerç‰ˆæœ¬18.06.1-ceã€ingress-nginx-controllerç‰ˆæœ¬0.25.0
Ingress
Ingress ç»„æˆï¼Ÿ  å°†Nginxçš„é…ç½®æŠ½è±¡æˆä¸€ä¸ªIngresså¯¹è±¡ï¼Œæ¯æ·»åŠ ä¸€ä¸ªæ–°çš„æœåŠ¡åªéœ€å†™ä¸€ä¸ªæ–°çš„Ingressçš„yamlæ–‡ä»¶å³å¯
 å°†æ–°åŠ å…¥çš„Ingressè½¬åŒ–æˆNginxçš„é…ç½®æ–‡ä»¶å¹¶ä½¿ä¹‹ç”Ÿæ•ˆ
 ingress controller
 ingressæœåŠ¡
  Ingress å·¥ä½œåŸç†?  ingress controlleré€šè¿‡å’Œkubernetes apiäº¤äº’ï¼ŒåŠ¨æ€çš„å»æ„ŸçŸ¥é›†ç¾¤ä¸­ingressè§„åˆ™å˜åŒ–ï¼Œ ç„¶åè¯»å–å®ƒï¼ŒæŒ‰ç…§è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œè§„åˆ™å°±æ˜¯å†™æ˜äº†å“ªä¸ªåŸŸåå¯¹åº”å“ªä¸ªserviceï¼Œç”Ÿæˆä¸€æ®µnginxé…ç½®ï¼Œ å†å†™åˆ°nginx-ingress-controllerçš„podé‡Œï¼Œè¿™ä¸ªIngress controllerçš„podé‡Œè¿è¡Œç€ä¸€ä¸ªNginxæœåŠ¡ï¼Œæ§åˆ¶å™¨ä¼šæŠŠç”Ÿæˆçš„nginxé…ç½®å†™å…¥/etc/nginx.confæ–‡ä»¶ä¸­ï¼Œ ç„¶åreloadä¸€ä¸‹ä½¿é…ç½®ç”Ÿæ•ˆã€‚ä»¥æ­¤è¾¾åˆ°åŸŸååˆ†é…ç½®å’ŒåŠ¨æ€æ›´æ–°çš„é—®é¢˜ã€‚  Ingress å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ åŠ¨æ€é…ç½®æœåŠ¡ å¦‚æœæŒ‰ç…§ä¼ ç»Ÿæ–¹å¼, å½“æ–°å¢åŠ ä¸€ä¸ªæœåŠ¡æ—¶, æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æµé‡å…¥å£åŠ ä¸€ä¸ªåå‘ä»£ç†æŒ‡å‘æˆ‘ä»¬æ–°çš„æœåŠ¡. è€Œå¦‚æœç”¨äº†Ingress, åªéœ€è¦é…ç½®å¥½è¿™ä¸ªæœåŠ¡, å½“æœåŠ¡å¯åŠ¨æ—¶, ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°Ingressçš„ä¸­, ä¸éœ€è¦è€Œå¤–çš„æ“ä½œ.
å‡å°‘ä¸å¿…è¦çš„ç«¯å£æš´éœ² é…ç½®è¿‡k8sçš„éƒ½æ¸…æ¥š, ç¬¬ä¸€æ­¥æ˜¯è¦å…³é—­é˜²ç«å¢™çš„, ä¸»è¦åŸå› æ˜¯k8sçš„å¾ˆå¤šæœåŠ¡ä¼šä»¥NodePortæ–¹å¼æ˜ å°„å‡ºå», è¿™æ ·å°±ç›¸å½“äºç»™å®¿ä¸»æœºæ‰“äº†å¾ˆå¤šå­”, æ—¢ä¸å®‰å…¨ä¹Ÿä¸ä¼˜é›…. è€ŒIngresså¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜, é™¤äº†Ingressè‡ªèº«æœåŠ¡å¯èƒ½éœ€è¦æ˜ å°„å‡ºå», å…¶ä»–æœåŠ¡éƒ½ä¸è¦ç”¨NodePortæ–¹å¼
Ingresså½“å‰çš„å®ç°æ–¹å¼ï¼Ÿ ingress-nginx-controller ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ingress-nginx-controllerï¼Œç”¨luaå®ç°äº†å½“upstreamå˜åŒ–æ—¶ä¸ç”¨reloadï¼Œå¤§å¤§å‡å°‘äº†ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºæœåŠ¡çš„é‡å¯ã€å‡çº§å¼•èµ·çš„IPå˜åŒ–å¯¼è‡´çš„nginx reloadã€‚
ä»¥ä¸‹å°±ingress-nginx-controllerçš„éƒ¨ç½²åšç®€å•è®°å½•ï¼š</description>
    </item>
    
    <item>
      <title>k8sä½¿ç”¨Jobæ‰§è¡Œä»»åŠ¡å¤±è´¥äº†æ€ä¹ˆåŠ</title>
      <link>https://liabio.github.io/post/2019-09-24-k8s-job-execute-fail-do-what/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-k8s-job-execute-fail-do-what/</guid>
      <description>å‰è¨€ æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ã€æˆ‘çš„å°ç¢—æ±¤ã€‘æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚æ‰«ç å…³æ³¨ï¼š
Kubernetes ä¸­ä½¿ç”¨ Job å’Œ CronJob ä¸¤ä¸ªèµ„æºåˆ†åˆ«æä¾›äº†ä¸€æ¬¡æ€§ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡çš„ç‰¹æ€§ï¼Œè¿™ä¸¤ç§å¯¹è±¡ä¹Ÿä½¿ç”¨æ§åˆ¶å™¨æ¨¡å‹æ¥å®ç°èµ„æºçš„ç®¡ç†ï¼Œæˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« æ¥ä»‹ç»Jobæ‰§è¡Œå¦‚æœå¤±è´¥äº†ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ
ä¿®æ”¹job-fail.yamlï¼Œæ•…æ„å¼•å…¥ä¸€ä¸ªé”™è¯¯ï¼š Never å¦‚æœå°† restartPolicy è®¾ç½®ä¸º Never ä¼šæ€ä¹ˆæ ·ï¼Ÿä¸‹é¢æˆ‘ä»¬å®è·µä¸€ä¸‹ï¼Œä¿®æ”¹job-fail.yamlåé‡æ–°å¯åŠ¨ã€‚
è¿è¡Œ Job å¹¶æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°Neverç­–ç•¥çš„jobï¼Œpodå¤±è´¥åï¼Œé‡æ–°åˆ›å»ºï¼š ç›´åˆ°é‡æ–°åˆ›å»º7ä¸ªï¼ˆspec.backoffLimité»˜è®¤ä¸º6ï¼Œå³é‡è¯•6æ¬¡ï¼Œå…±7ä¸ªpodï¼‰podéƒ½å¤±è´¥åï¼Œè®¤ä¸ºå¤±è´¥ï¼Œjobçš„statusé‡Œä¼šæ›´æ–°ä¸ºFailed å½“å‰ Completion çš„æ•°é‡ä¸º 0 æŸ¥çœ‹ Pod çš„çŠ¶æ€ï¼š
å¯ä»¥çœ‹åˆ°æœ‰å¤šä¸ª Podï¼ŒçŠ¶æ€å‡ä¸æ­£å¸¸ã€‚kubectl describe pod æŸ¥çœ‹æŸä¸ª Pod çš„å¯åŠ¨æ—¥å¿—ï¼š
æ—¥å¿—æ˜¾ç¤ºæ²¡æœ‰å¯æ‰§è¡Œç¨‹åºï¼Œç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚
ä¸ºä»€ä¹ˆ kubectl get pod ä¼šçœ‹åˆ°è¿™ä¹ˆå¤šä¸ªå¤±è´¥çš„ Podï¼Ÿ
åŸå› æ˜¯ï¼šå½“ç¬¬ä¸€ä¸ª Pod å¯åŠ¨æ—¶ï¼Œå®¹å™¨å¤±è´¥é€€å‡ºï¼Œæ ¹æ® restartPolicy: Neverï¼Œæ­¤å¤±è´¥å®¹å™¨ä¸ä¼šè¢«é‡å¯ï¼Œä½† Job DESIRED çš„ Pod æ˜¯ 1ï¼Œç›®å‰ SUCCESSFUL ä¸º 0ï¼Œä¸æ»¡è¶³ï¼Œæ‰€ä»¥ Job controller ä¼šå¯åŠ¨æ–°çš„ Podï¼Œç›´åˆ° SUCCESSFUL ä¸º 1ã€‚å¯¹äºæˆ‘ä»¬è¿™ä¸ªä¾‹å­ï¼ŒSUCCESSFUL æ°¸è¿œä¹Ÿåˆ°ä¸äº† 1ï¼Œæ‰€ä»¥ Job controller ä¼šä¸€ç›´åˆ›å»ºæ–°çš„ Podï¼Œç›´åˆ°è®¾ç½®çš„æ•°é‡ï¼Œå¤±è´¥åpodä¸ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼Œä¸ºäº†ç»ˆæ­¢è¿™ä¸ªè¡Œä¸ºï¼Œåªèƒ½åˆ é™¤ Jobï¼Œpodä¹Ÿä¼šè¢«åŒæ—¶åˆ æ‰ã€‚</description>
    </item>
    
    <item>
      <title>ä¸€æ¬¡socket.error: [Errno 99] Cannot assign requested addressæŠ¥é”™æ’æŸ¥</title>
      <link>https://liabio.github.io/post/2019-09-24-docker-create-svc-in-cloudserver/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-docker-create-svc-in-cloudserver/</guid>
      <description>ä»Šå¤©åœ¨Ucloudå›½é™…ç‰ˆçš„æœºå™¨ä¸Šé…ç½®æŸä¸ªä¸å¯æè¿°çš„æœåŠ¡æ—¶ï¼Œé‡åˆ°äº† socket.error: [Errno 99] Cannot assign requested address çš„é”™è¯¯ï¼Œè¯¦ç»†å¦‚ä¸‹ï¼š [root@liabio ~]# docker logs c0c34ba49967 2019-07-15 00:02:26 INFO loading libcrypto from libcrypto.so.1.0.0 2019-07-15 00:02:26 INFO starting server at 128.1.132.124:8002 Traceback (most recent call last): File &amp;quot;/usr/local/bin/ssserver&amp;quot;, line 11, in &amp;lt;module&amp;gt; sys.exit(main()) File &amp;quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/server.py&amp;quot;, line 68, in main tcp_servers.append(tcprelay.TCPRelay(a_config, dns_resolver, False)) File &amp;quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/tcprelay.py&amp;quot;, line 582, in __init__ server_socket.bind(sa) File &amp;quot;/usr/lib/python2.7/socket.py&amp;quot;, line 228, in meth return getattr(self._sock,name)(*args) socket.error: [Errno 99] Cannot assign requested address  åŸå…ˆä»¥ä¸ºæ˜¯resolverçš„é—®é¢˜ï¼Œä½†æ˜¯æŒ‡å®šäº†Googleçš„nameserversä»ç„¶æ— è§£ï¼Œäºæ˜¯æƒ³åˆ°å¯èƒ½æ˜¯æœåŠ¡å™¨IPåœ°å€è®¾ç½®çš„é—®é¢˜ï¼Œå› ä¸ºé˜¿é‡Œäº‘é»˜è®¤ç»™ç½‘å¡ç»‘å®šçš„æ˜¯å†…ç½‘IPåœ°å€ã€‚</description>
    </item>
    
    <item>
      <title>äº‘æœåŠ¡å™¨ä½¿ç”¨dockeræ­å»ºæœåŠ¡</title>
      <link>https://liabio.github.io/post/2019-09-24-socket-error-debug/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-socket-error-debug/</guid>
      <description>å‰æï¼šäºšé©¬é€Šäº‘å·²ç»é…ç½®å¥½å¯åŠ¨ã€‚
å®‰å…¨ç»„å…¥ç«™ç­–ç•¥å¦‚ä¸‹ï¼š
å‡ºç«™ç­–ç•¥å¦‚ä¸‹ï¼š ç™»é™†EC2åï¼Œé»˜è®¤åªèƒ½ç”¨ec2-userç”¨æˆ·ç™»é™†ï¼Œç„¶ååˆ‡æ¢åˆ°rootï¼š
sudo su  ç”¨yumæ‰§è¡Œå®‰è£…dockeræç¤ºNo package docker avaible
yum install docker -y  è§£å†³æ–¹æ³•ï¼š åœ¨/etc/yum.repos.d/ä¸‹åŠ CentOS7-Base-163.repoæ–‡ä»¶ï¼š
vi CentOS7-Base-163.repo  # CentOS-Base.repo # # The mirror system uses the connecting IP address of the client and the # update status of each mirror to pick mirrors that are updated to and # geographically close to the client. You should use this for CentOS updates # unless you are manually picking other mirrors.</description>
    </item>
    
    <item>
      <title>å²ä¸Šæœ€å…¨dockeråŸºç¡€çŸ¥è¯†æ±‡æ€»</title>
      <link>https://liabio.github.io/post/2019-09-24-docker-comprehensive-knowledge/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-docker-comprehensive-knowledge/</guid>
      <description>å‰è¨€ æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ã€æˆ‘çš„å°ç¢—æ±¤ã€‘æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚æ‰«ç å…³æ³¨ï¼š
æ­£æ–‡ Dockerå¸¸ç”¨å‘½ä»¤
run
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]  -eè®¾ç½®ç¯å¢ƒå˜é‡ï¼›-e username=zhj
&amp;ndash;nameä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›&amp;ndash;name=zhj
-pæŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£ -p 80:8080
-tä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›
-iä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›
-dåå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›
-vå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ã€‚å°†å®¿ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚
docker cp
å¤åˆ¶å®¹å™¨å†…çš„æ–‡ä»¶åˆ°å®¿ä¸»æœº  docker start
å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»è¢«åœæ­¢çš„å®¹å™¨
docker stop
åœæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨
docker restart
é‡å¯å®¹å™¨
docker rm
åˆ é™¤å®¹å™¨
docker pause
æš‚åœå®¹å™¨ä¸­æ‰€æœ‰çš„è¿›ç¨‹;
docker unpause
æ¢å¤å®¹å™¨ä¸­æ‰€æœ‰çš„è¿›ç¨‹;
docker exec ï¼š
åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
docker exec -it mynginx /bin/sh /root/runoob.sh  docker logs
è·å–å®¹å™¨çš„æ—¥å¿—;
docker ps
åˆ—å‡ºUPçš„å®¹å™¨ï¼›docker ps -aåˆ—å‡ºæ‰€æœ‰å®¹å™¨ã€‚åŒ…æ‹¬Exitedç­‰çŠ¶æ€çš„å®¹å™¨ï¼›</description>
    </item>
    
    <item>
      <title>é‡‡å‘æŒ‡å—â€”â€”k8såŸŸåè§£æcorednsé—®é¢˜æ’æŸ¥è¿‡ç¨‹</title>
      <link>https://liabio.github.io/post/2019-09-24-k8s-domain-resolve-coredns-problem-debug/</link>
      <pubDate>Tue, 24 Sep 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-09-24-k8s-domain-resolve-coredns-problem-debug/</guid>
      <description>å‰è¨€ æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ã€æˆ‘çš„å°ç¢—æ±¤ã€‘æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚æ‰«ç å…³æ³¨ï¼š
æ­£æ–‡ å‰å‡ å¤©ï¼Œåœ¨ucloudä¸Šæ­å»ºçš„k8sé›†ç¾¤ï¼ˆæ­å»ºæ•™ç¨‹åç»­ä¼šå‘å‡ºï¼‰ã€‚ä»Šå¤©å‘ç°åŸŸåè§£æä¸äº†ã€‚
ç»„ä»¶ç‰ˆæœ¬ï¼šk8s 1.15.0ï¼Œcorednsï¼š1.3.1
è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š é¦–å…ˆç”¨ä»¥ä¸‹yamlæ–‡ä»¶åˆ›å»ºäº†ä¸€ä¸ªnginxæœåŠ¡
apiVersion: v1 kind: Service metadata: name: nginx-svc-old labels: app: nginx-svc spec: selector: app: nginx ports: - protocol: TCP port: 80 targetPort: 80 --- apiVersion: apps/v1beta1 kind: Deployment metadata: name: nginx-old spec: replicas: 1 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80  åˆ›å»ºå¥½ä¹‹åï¼š å› åªéƒ¨ç½²äº†ä¸€ä¸ªmasterèŠ‚ç‚¹ã€‚åœ¨masterå®¿ä¸»æœºä¸Šç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
nslookup nginx-svc-old.default.svc  å‘ç°ä¸èƒ½è§£æåŸŸåã€‚äº‹å…ˆä¹Ÿåœ¨å®¿ä¸»æœºä¸Š/etc/resolv.confé‡Œé…ç½®äº†nameserver {corednsçš„podIP} è¿™æ ·ä¸€æ¥ï¼Œå°±ä»¥ä¸ºå¯èƒ½æ˜¯corednsæœ‰é—®é¢˜ã€‚ã€‚
ç„¶åç”¨ä»¥ä¸‹yamlåˆ›å»ºäº†ä¸€ä¸ªbusyboxä½œä¸ºè°ƒè¯•å·¥å…·ï¼š</description>
    </item>
    
    <item>
      <title>æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºkubernetesé›†ç¾¤.md</title>
      <link>https://liabio.github.io/post/2019-05-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAkubernetes%E9%9B%86%E7%BE%A4/</link>
      <pubDate>Tue, 14 May 2019 23:44:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-05-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAkubernetes%E9%9B%86%E7%BE%A4/</guid>
      <description>cat &amp;gt; /etc/yum.repos.d/kubernetes.repo &amp;lt;&amp;lt; EOF [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/ enabled=1 gpgcheck=0 repo_gpgcheck=1 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF  å®‰è£…kubeadmã€kubectlã€kubelet
yum install -y kubeadm kubelet kubectl  å¦‚æœåœ¨äº‘æœåŠ¡å™¨ä¸Šæ­å»ºæ—¶ï¼ŒIP-18.219.28.143æ˜¯å…¬ç½‘IP
kubeadm init --kubernetes-version=v1.14.1 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --apiserver-advertise-address=18.219.28.143 --ignore-preflight-errors=Swap,NumCPU   initçš„æ—¶å€™å¯èƒ½ä¼šï¼š  [kubelet-check] Initial timeout of 40s passed
![](/img/2019-05-14-æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºkubernetesé›†ç¾¤\install_kubernetes_cluster2.png) éœ€è¦æŠŠ/etc/kubernetes/manifests/etcd.yamlæ–‡ä»¶é‡Œçš„IPä¿®æ”¹ä¸º127.0.0.1 ![](/img/2019-05-14-æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºkubernetesé›†ç¾¤\install_kubernetes_cluster3.png) yum list kubeadm --showduplicates |sort -r yum list kubectl --showduplicates |sort -r yum list kubelet --showduplicates |sort -r yum list kubernets-cni --showduplicates |sort -r  initä¹‹åè®°å½•joinå‘½ä»¤ï¼š</description>
    </item>
    
    <item>
      <title>æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºkubernetesé›†ç¾¤1</title>
      <link>https://liabio.github.io/post/2019-05-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAkubernetes%E9%9B%86%E7%BE%A41/</link>
      <pubDate>Tue, 14 May 2019 23:44:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-05-14-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAkubernetes%E9%9B%86%E7%BE%A41/</guid>
      <description>éƒ¨ç½² ä»¥CentOS7ä¸ºåŸºç¡€ï¼Œæ­å»ºä¸€ä¸ªMasterä¸»æœºå’Œä¸‰ä¸ªNodeä¸»æœºï¼Œå„ä¸ªNodeä¸»æœºçš„é…ç½®æ–¹å¼åŸºæœ¬ç›¸åŒã€‚
OS: CentOS 7.5 x86_64 Container runtime: Docker 18.06.ce Kubernetes: 1.13 IP åœ°å€ ä¸»æœºå è§’è‰² 192.168.50.71 master, master.kubernetes.io master 192.168.50.72 node01, node01.kubernetes.io node 192.168.50.73 node02, node02.kubernetes.io node 192.168.50.74 node03, node03.kubernetes.io node è¿™é‡Œéœ€è¦ä½¿ç”¨å¸¸è§„çš„åŸŸåæ ¼å¼ï¼Œå› ä¸ºåé¢éœ€è¦ä¸ºé›†ç¾¤é…ç½®Kubernetes Dashboardè¦æ±‚æœ‰SSLæ•°å­—ç­¾åã€‚
ç³»ç»Ÿé…ç½® é…ç½®hostï¼Œ
cat /etc/hosts 192.168.50.71	master	master.kubernetes.io 192.168.50.72	node1	node01.kubernetes.io 192.168.50.73	node2	node02.kubernetes.io 192.168.50.74	node3	node03.kubernetes.io  å…³é—­é˜²ç«å¢™ï¼Œé€‰æ‹©iptableåŠ å…¥ç«¯å£æˆ–ç¦ç”¨é˜²ç«å¢™æœåŠ¡ä¸¤ç§æ–¹å¼ã€‚è¿™é‡Œç®€å•èµ·è§ï¼Œç¦ç”¨é˜²ç«å¢™ï¼š
sudo systemctl stop firewalld sudo systemctl disable firewalld  ç¦ç”¨SELINUX(å®‰å…¨å¢å¼ºå‹ Linux Security-Enhanced Linux, SELinux ä¸»è¦ä½œç”¨å°±æ˜¯æœ€å¤§é™åº¦åœ°å‡å°ç³»ç»Ÿä¸­æœåŠ¡è¿›ç¨‹å¯è®¿é—®çš„èµ„æº[æœ€å°æƒé™åŸåˆ™])ï¼Œ
sudo setenforce 0 sudo vi /etc/selinux/config SELINUX=disabled  æ‰€æœ‰èŠ‚ç‚¹å…³é—­äº¤æ¢åˆ†åŒºï¼Œ</description>
    </item>
    
    <item>
      <title>æ­å»ºk8sç¯å¢ƒæ—¶gcr.ioå’Œquay.ioæ‹‰å–é•œåƒå¤±è´¥</title>
      <link>https://liabio.github.io/post/2019-05-14-%E6%90%AD%E5%BB%BAk8s%E7%8E%AF%E5%A2%83%E6%97%B6gcr.io%E5%92%8Cquay.io%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%E5%A4%B1%E8%B4%A5/</link>
      <pubDate>Tue, 14 May 2019 23:44:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-05-14-%E6%90%AD%E5%BB%BAk8s%E7%8E%AF%E5%A2%83%E6%97%B6gcr.io%E5%92%8Cquay.io%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%E5%A4%B1%E8%B4%A5/</guid>
      <description>k8såœ¨ä½¿ç”¨ç¼–æ’ï¼ˆmanifestï¼‰å·¥å…·è¿›è¡Œyamlæ–‡ä»¶å¯åŠ¨podæ—¶ï¼Œä¼šé‡åˆ°å®˜æ–¹æ‰€ç»™ä¾‹å­ä¸­spec.containers.imageåŒ…å«ï¼š
quay.io/coreos/example_ gcr.io/google_containers/example_  ä¹Ÿå°±æ˜¯è¯´ï¼Œä»quay.ioå’Œgcr.ioè¿›è¡Œé•œåƒæ‹‰å–ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå›½å†…è®¿é—®å¤–ç½‘æ˜¯è¢«å±è”½äº†çš„ã€‚å¯ä»¥å°†å…¶æ›¿æ¢ä¸º quay-mirror.qiniu.com å’Œ registry.aliyuncs.com
ä¾‹å¦‚ ä¸‹æ‹‰é•œåƒï¼šquay.io/coreos/flannel:v0.10.0-s390x å¦‚æœæ‹‰å–è¾ƒæ…¢ï¼Œå¯ä»¥æ”¹ä¸ºï¼šquay-mirror.qiniu.com/coreos/flannel:v0.10.0-s390x
ä¸‹æ‹‰é•œåƒï¼šgcr.io/google_containers/kube-proxy å¯ä»¥æ”¹ä¸ºï¼š registry.aliyuncs.com/google_containers/kube-proxy</description>
    </item>
    
    <item>
      <title>Hugoæ­å»ºåšå®¢æ•™ç¨‹</title>
      <link>https://liabio.github.io/post/2019-05-03-hugo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/</link>
      <pubDate>Fri, 03 May 2019 10:48:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-05-03-hugo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/</guid>
      <description>åœ¨ç¼–è¯‘æ—¶æŠ¥é”™å¦‚ä¸‹ï¼š
Building sites â€¦ ERROR 2019/05/03 10:36:45 Failed to read Git log: fatal: Not a git repository (or any of the parent d irectories): .git Building sites â€¦ ERROR 2019/05/03 10:45:16 Failed to read Git log: fatal: your current branch &#39;master&#39; does not have a ny commits yet  éœ€è¦å…ˆåœ¨ç«™ç‚¹æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
git init git add . git commit -m &#39;test&#39;  config.tomlä¸­çš„baseUrlä¸ºhttp://liabio.github.io ä¸ä¿®æ”¹ï¼Œè°ƒè¯•æ—¶ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šbaseUrlï¼šä¸º http://localhost:1313/
hugo server -D -t even --baseUrl=&amp;quot;http://localhost:1313/&amp;quot;  åœ¨ç½‘ç«™https://analytics.</description>
    </item>
    
    <item>
      <title>åšå®¢test</title>
      <link>https://liabio.github.io/post/2019-05-04-%E5%8D%9A%E5%AE%A2test/</link>
      <pubDate>Thu, 02 May 2019 23:44:21 +0800</pubDate>
      
      <guid>https://liabio.github.io/post/2019-05-04-%E5%8D%9A%E5%AE%A2test/</guid>
      <description>asssssssssssssss</description>
    </item>
    
    <item>
      <title>kube-schedulerè°ƒåº¦æ‰©å±•</title>
      <link>https://liabio.github.io/post/2019-05-01-kube-scheduler%E8%B0%83%E5%BA%A6%E6%89%A9%E5%B1%95/</link>
      <pubDate>Thu, 02 May 2019 00:00:00 +0000</pubDate>
      
      <guid>https://liabio.github.io/post/2019-05-01-kube-scheduler%E8%B0%83%E5%BA%A6%E6%89%A9%E5%B1%95/</guid>
      <description>å‰è¨€ æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ã€æˆ‘çš„å°ç¢—æ±¤ã€‘æœ¬å…¬ä¼—å·å…è´¹æä¾›csdnä¸‹è½½æœåŠ¡ï¼Œæµ·é‡ITå­¦ä¹ èµ„æºï¼Œå¦‚æœä½ å‡†å¤‡å…¥ITå‘ï¼ŒåŠ±å¿—æˆä¸ºä¼˜ç§€çš„ç¨‹åºçŒ¿ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºå¾ˆé€‚åˆä½ ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºjavaã€goã€pythonã€springcloudã€elkã€åµŒå…¥å¼ ã€å¤§æ•°æ®ã€é¢è¯•èµ„æ–™ã€å‰ç«¯ ç­‰èµ„æºã€‚æ‰«ç å…³æ³¨ï¼š
 æ­£æ–‡ Kubernetes è‡ªå¸¦äº†ä¸€ä¸ªé»˜è®¤è°ƒåº¦å™¨kube-schedulerï¼Œå…¶å†…ç½®äº†å¾ˆå¤šèŠ‚ç‚¹é¢„é€‰å’Œä¼˜é€‰çš„è°ƒåº¦ç®—æ³•ï¼Œä¸€èˆ¬è°ƒåº¦åœºæ™¯ä¸‹å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚ä½†æ˜¯åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œé»˜è®¤è°ƒåº¦å™¨ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¤æ‚çš„è°ƒåº¦éœ€æ±‚ã€‚æˆ‘ä»¬å°±éœ€è¦å¯¹è°ƒåº¦å™¨è¿›è¡Œæ‰©å±•ï¼Œä»¥è¾¾åˆ°è°ƒåº¦é€‚åˆä¸šåŠ¡åœºæ™¯çš„ç›®çš„ã€‚
èƒŒæ™¯ ä¸­é—´ä»¶rediså®¹å™¨åŒ–åï¼Œéœ€è¦ä¸¤ä¸»ä¸èƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¸€å¯¹ä¸»ä»ä¸èƒ½åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šï¼›elasticsearchå®¹å™¨åŒ–åï¼Œä¸¤ä¸ªdataå®ä¾‹ä¸èƒ½åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚åœ¨è¿™ç±»åœºæ™¯ä¸‹ï¼Œé»˜è®¤è°ƒåº¦å™¨å†…ç½®çš„é¢„é€‰ã€ä¼˜é€‰ç®—æ³•ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸‰ç§é€‰æ‹©ï¼š
 å°†æ–°çš„è°ƒåº¦ç®—æ³•æ·»åŠ åˆ°é»˜è®¤è°ƒåº¦ç¨‹åºä¸­ï¼Œå¹¶é‡æ–°ç¼–è¯‘é•œåƒï¼Œæœ€ç»ˆè¯¥é•œåƒè¿è¡Œçš„å®ä¾‹ä½œä¸ºkubernetesé›†ç¾¤è°ƒåº¦å™¨ï¼›
 å‚è€ƒkube-schedulerå®ç°æ»¡è¶³è‡ªå·±ä¸šåŠ¡åœºæ™¯çš„è°ƒåº¦ç¨‹åºï¼Œå¹¶ç¼–è¯‘é•œåƒï¼Œå°†è¯¥ç¨‹åºä½œä¸ºç‹¬ç«‹çš„è°ƒåº¦å™¨è¿è¡Œåˆ°kubernetesé›†ç¾¤å†…ï¼Œéœ€è¦ç”¨è¯¥è°ƒåº¦å™¨è°ƒåº¦çš„podå®ä¾‹ï¼Œåœ¨spec.schedulerNameé‡ŒæŒ‡å®šè¯¥è°ƒåº¦å™¨ï¼›
   å®ç°â€œè°ƒåº¦æ‰©å±•ç¨‹åºâ€œï¼šé»˜è®¤è°ƒåº¦å™¨kube-scheduleråœ¨è¿›è¡Œé¢„é€‰æ—¶ä¼šè°ƒç”¨è¯¥æ‰©å±•ç¨‹åºè¿›è¡Œè¿‡æ»¤èŠ‚ç‚¹ï¼›åœ¨ä¼˜é€‰æ—¶ä¼šè°ƒç”¨è¯¥æ‰©å±•ç¨‹åºè¿›è¡Œç»™èŠ‚ç‚¹æ‰“åˆ†ï¼Œæˆ–è€…åœ¨bindæ“ä½œæ—¶ï¼Œè°ƒç”¨è¯¥æ‰©å±•å™¨è¿›è¡Œbindæ“ä½œã€‚  å¯¹ä¸Šè¿°ä¸‰ç§æ–¹å¼è¿›è¡Œè¯„ä¼°ï¼š
ç¬¬ä¸€ç§ï¼šå°†è‡ªå·±çš„è°ƒåº¦ç®—æ³•æ·»åŠ åˆ°é»˜è®¤è°ƒåº¦å™¨kube-schedulerä¸­ï¼Œå¯¹åŸç”Ÿä»£ç ä¾µå…¥æ€§è¾ƒé«˜ï¼Œè€Œä¸”éšç€kubernetesç‰ˆæœ¬å‡çº§ï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿè¾ƒé«˜ï¼›
ç¬¬äºŒç§ï¼šé»˜è®¤è°ƒåº¦å™¨é‡Œå†…ç½®äº†å¾ˆå¤šä¼˜ç§€è°ƒåº¦ç®—æ³•ï¼Œå¦‚ï¼šæ£€æŸ¥èŠ‚ç‚¹èµ„æºæ˜¯å¦å……è¶³ï¼›ç«¯å£æ˜¯å¦å ç”¨ï¼›volumeæ˜¯å¦è¢«å…¶ä»–podæŒ‚è½½ï¼›äº²å’Œæ€§ï¼›å‡è¡¡èŠ‚ç‚¹èµ„æºåˆ©ç”¨ç­‰ï¼Œå¦‚æœå®Œå…¨ä½¿ç”¨è‡ªå·±å¼€å‘çš„è°ƒåº¦å™¨ç¨‹åºï¼Œå¯èƒ½åœ¨è¾¾åˆ°äº†å®é™…åœºæ™¯è°ƒåº¦éœ€æ±‚åŒæ—¶ï¼Œå¤±å»æ›´ä½³çš„è°ƒåº¦æ–¹æ¡ˆï¼Œé™¤éé›†æˆé»˜è®¤è°ƒåº¦å™¨ä¸­çš„ç®—æ³•åˆ°è‡ªå·±ç‹¬ç«‹è°ƒåº¦ç¨‹åºä¸­ï¼Œä½†è¿™æ— ç–‘æ˜¯ä¸ç°å®çš„ï¼›
ç¬¬ä¸‰ç§ï¼šé€šè¿‡å¯åŠ¨å‚æ•°çš„policyé…ç½®ï¼Œé€‰ç”¨æŸäº›é»˜è®¤è°ƒåº¦å™¨ä¸­çš„é¢„é€‰ã€ä¼˜é€‰è°ƒåº¦ç®—æ³•çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å¤–éƒ¨æ‰©å±•è°ƒåº¦ç¨‹åºçš„ç®—æ³•ï¼Œè®¡ç®—å¾—åˆ°æœ€ä¼˜çš„è°ƒåº¦èŠ‚ç‚¹ï¼Œæ— éœ€ä¿®æ”¹kube-schedulerä»£ç ï¼Œåªéœ€è¦åœ¨å¯åŠ¨å‚æ•°ä¸­å¢åŠ é…ç½®æ–‡ä»¶å³å¯å°†é»˜è®¤è°ƒåº¦ç¨‹åºå’Œæ‰©å±•è°ƒåº¦ç¨‹åºç›¸äº’å…³è”ã€‚
å¯ä»¥å‚è€ƒï¼š
https://github.com/kubernetes/community/blob/master/contributors/design-proposals/scheduling/scheduler_extender.md
æ•…é‡‡ç”¨ç¬¬ä¸‰ç§ï¼šå®ç°æ‰©å±•è°ƒåº¦ç¨‹åºçš„æ–¹æ¡ˆã€‚
æ•´ä½“æ¶æ„ kube-scheduleråœ¨è°ƒåº¦podå®ä¾‹æ—¶ï¼Œé¦–å…ˆè·å–åˆ°Node1ã€Node2ã€Node3ä¸‰ä¸ªèŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿›è¡Œé»˜è®¤çš„é¢„é€‰é˜¶æ®µï¼Œç­›é€‰æ»¡è¶³è¦æ±‚çš„èŠ‚ç‚¹ï¼Œå…¶æ¬¡å†è°ƒç”¨æ‰©å±•ç¨‹åºä¸­çš„é¢„é€‰ç®—æ³•ï¼Œé€‰å‡ºå‰©ä¸‹çš„èŠ‚ç‚¹ï¼Œå‡è®¾é¢„é€‰é˜¶æ®µNode3ä¸Šèµ„æºä¸è¶³è¢«è¿‡æ»¤æ‰ï¼Œé¢„é€‰ç»“æŸååªå‰©Node1å’ŒNode2ï¼›Node1å’ŒNode2è¿›å…¥kube-scheduleré»˜è®¤çš„ä¼˜é€‰é˜¶æ®µè¿›è¡ŒèŠ‚ç‚¹æ‰“åˆ†ï¼Œå…¶æ¬¡å†è°ƒç”¨æ‰©å±•è°ƒåº¦ç¨‹åºä¸­çš„ä¼˜é€‰ç®—æ³•è¿›è¡Œæ‰“åˆ†ï¼Œkube-schedulerä¼šå°†æ‰€æœ‰ç®—æ³•çš„æ‰“åˆ†ç»“æœè¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œè·å¾—åˆ†æ•°æœ€é«˜çš„èŠ‚ç‚¹ä½œä¸ºpodæœ€ç»ˆbindèŠ‚ç‚¹ï¼Œç„¶åkube-schedulerè°ƒç”¨apiserverè¿›è¡Œbindæ“ä½œã€‚
å®ç°æ­¥éª¤ å®ç°æ‰©å±•è°ƒåº¦ç¨‹åºä»£ç  ç¼–å†™æ‰©å±•è°ƒåº¦å™¨ç¨‹åºä»£ç ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡è°ƒåº¦åœºæ™¯ç¼–å†™é¢„é€‰é€»è¾‘ã€ä¼˜é€‰é€»è¾‘ï¼š
å®ç°é¢„é€‰æ¥å£ï¼Œå…¥å‚ä¸ºschedulerapi.ExtenderArgsï¼Œå‡ºå‚ä¸ºschedulerapi.ExtenderFilterResultï¼š
å®ç°ä¼˜é€‰æ¥å£ï¼Œå…¥å‚ä¸ºschedulerapi.ExtenderArgsï¼Œå‡ºå‚ä¸ºschedulerapi.HostPriorityListï¼š
æš´éœ²httpæ¥å£ï¼š
å‚è€ƒï¼š
https://github.com/ll837448792/k8s-scheduler-extender-example
é»˜è®¤è°ƒåº¦å™¨éƒ¨ç½² ç”±äºkubernetesé›†ç¾¤å†…å·²ç»æœ‰äº†ä¸€ä¸ªåä¸ºdefault-schedulerçš„é»˜è®¤è°ƒåº¦å™¨ï¼Œä¸ºäº†ä¸å½±å“é›†ç¾¤æ­£å¸¸è°ƒåº¦åŠŸèƒ½ï¼Œä¸‹é¢ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºmy-kube-schedulerçš„è°ƒåº¦å™¨ï¼Œè¿™ä¸ªè°ƒåº¦å™¨å’Œdefault-scheduleré™¤äº†å¯åŠ¨å‚æ•°ä¸ä¸€æ ·å¤–ï¼Œé•œåƒæ— å·®åˆ«ã€‚
1ã€åˆ›å»ºä¸€ä¸ªåä¸ºmy-scheduler-configçš„configmapsï¼Œdataä¸‹çš„config.yamlæ–‡ä»¶æŒ‡å®šäº†è°ƒåº¦å™¨çš„ä¸€äº›å‚æ•°ï¼ŒåŒ…æ‹¬leaderé€‰ä¸¾ï¼Œè°ƒåº¦ç®—æ³•ç­–ç•¥çš„é€‰æ‹©ï¼ˆæŒ‡å®šå¦ä¸€ä¸ªconfigmapsï¼‰ï¼Œä»¥åŠæŒ‡å®šè°ƒåº¦å™¨çš„åç§°ä¸ºmy-kube-schedulerã€‚
ç›¸åº”çš„åˆ›å»ºä¸€ä¸ªmy-scheduler-policyçš„configmapsï¼Œé‡Œé¢æŒ‡å®šäº†é€‰æ‹©å“ªäº›é¢„é€‰ã€ä¼˜é€‰ç­–ç•¥ï¼Œä»¥åŠå¤–éƒ¨æ‰©å±•è°ƒåº¦ç¨‹åºçš„urlPrefixã€æ‰©å±•é¢„é€‰URIã€æ‰©å±•ä¼˜é€‰URIã€æ‰©å±•podä¼˜å…ˆçº§æŠ¢å URIã€æ‰©å±•bind URIã€æ‰©å±•ä¼˜é€‰ç®—æ³•çš„æƒé‡ç­‰ã€‚
ä»¥ä¿è¯my-kube-schedulerå’Œæ‰©å±•è°ƒåº¦ç¨‹åºçš„é€šä¿¡ã€‚
apiVersion: v1 kind: ConfigMap metadata: name: my-scheduler-config namespace: kube-system data: config.yaml: | apiVersion: kubescheduler.config.k8s.io/v1alpha1 kind: KubeSchedulerConfiguration schedulerName: my-kube-scheduler algorithmSource: policy: configMap: namespace: kube-system name: my-scheduler-policy leaderElection: leaderElect: false lockObjectName: my-kube-scheduler lockObjectNamespace: kube-system --- apiVersion: v1 kind: ConfigMap metadata: name: my-scheduler-policy namespace: kube-system data: policy.</description>
    </item>
    
    <item>
      <title>å¿«é€Ÿæ­å»ºä¸ªäººåšå®¢</title>
      <link>https://liabio.github.io/post/2017-02-06-%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</link>
      <pubDate>Mon, 06 Feb 2017 00:00:00 +0000</pubDate>
      
      <guid>https://liabio.github.io/post/2017-02-06-%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</guid>
      <description>æ­£æ‰€è°“å‰äººæ ½æ ‘ï¼Œåäººä¹˜å‡‰ã€‚
æ„Ÿè°¢Huxproæä¾›çš„åšå®¢æ¨¡æ¿
æˆ‘çš„çš„åšå®¢
 å‰è¨€ ä» Jekyll åˆ° GitHub Pages ä¸­é—´è¸©äº†è®¸å¤šå‘ï¼Œç»ˆäºæŠŠæˆ‘çš„ä¸ªäººåšå®¢BY Blogæ­å»ºå‡ºæ¥äº†ã€‚ã€‚ã€‚
æœ¬æ•™ç¨‹é’ˆå¯¹çš„æ˜¯ä¸æ‡‚æŠ€æœ¯åˆæƒ³æ­å»ºä¸ªäººåšå®¢çš„å°ç™½ï¼Œæ“ä½œç®€å•æš´åŠ›ä¸”å¿«é€Ÿã€‚å½“ç„¶æ‡‚æŠ€æœ¯é‚£å°±æ›´å¥½äº†ã€‚
çœ‹çœ‹çœ‹åšå®¢çš„ä¸»é¡µæ ·å¼ï¼š

åœ¨æ‰‹æœºä¸Šçš„å¸ƒå±€ï¼š

åºŸè¯ä¸å¤šè¯´äº†ï¼Œå¼€å§‹è¿›å…¥æ­£æ–‡ã€‚
å¿«é€Ÿå¼€å§‹ ä»æ³¨å†Œä¸€ä¸ªGithubè´¦å·å¼€å§‹ æˆ‘é‡‡ç”¨çš„æ­å»ºåšå®¢çš„æ–¹å¼æ˜¯ä½¿ç”¨ GitHub Pages + jekyll çš„æ–¹å¼ã€‚
è¦ä½¿ç”¨ GitHub Pagesï¼Œé¦–å…ˆä½ è¦æ³¨å†Œä¸€ä¸ªGitHubè´¦å·ï¼ŒGitHub æ˜¯å…¨çƒæœ€å¤§çš„åŒæ€§äº¤å‹ç½‘ç«™(åæ§½ä¸‹ç¨‹åºå‘˜~)ï¼Œä½ å€¼å¾—æ‹¥æœ‰ã€‚
æ‹‰å–æˆ‘çš„åšå®¢æ¨¡æ¿ æ³¨å†Œå®Œæˆåæœç´¢ qiubaiying.github.io è¿›å…¥æˆ‘çš„ä»“åº“
ç‚¹å‡»å³ä¸Šè§’çš„ Fork å°†æˆ‘çš„ä»“åº“æ‹‰å€’ä½ çš„è´¦å·ä¸‹
ç¨ç­‰ä¸€ä¸‹ï¼Œç‚¹å‡»åˆ·æ–°ï¼Œä½ ä¼šçœ‹åˆ°Forkäº†æˆåŠŸçš„é¡µé¢
ä¿®æ”¹ä»“åº“å ç‚¹å‡»settingsè¿›å…¥è®¾ç½®
ä¿®æ”¹ä»“åº“åä¸º ä½ çš„Githubè´¦å·å.github.ioï¼Œç„¶å Rename
è¿™æ—¶ä½ åœ¨åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ ä½ çš„Githubè´¦å·å.github.io ä¾‹å¦‚:baiyingqiu.github.io
ä½ å°†ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢
è¯´æ˜å·²ç»æˆåŠŸä¸€åŠäº†ğŸ˜€ã€‚ã€‚ã€‚å½“ç„¶ï¼Œè¿˜éœ€è¦ä¿®æ”¹åšå®¢çš„é…ç½®æ‰èƒ½å˜æˆä½ çš„åšå®¢ã€‚
è‹¥æ˜¯å‡ºç°
åˆ™éœ€è¦ æ£€æŸ¥ä¸€ä¸‹ä½ çš„ä»“åº“åæ˜¯å¦æ­£ç¡®
æ•´ä¸ªç½‘ç«™ç»“æ„ ä¿®æ”¹Blogå‰æˆ‘ä»¬æ¥çœ‹çœ‹Jekyll ç½‘ç«™çš„åŸºç¡€ç»“æ„ï¼Œå½“ç„¶æˆ‘ä»¬çš„ç½‘ç«™æ¯”è¿™ä¸ªå¤æ‚ã€‚
â”œâ”€â”€ _config.yml â”œâ”€â”€ _drafts | â”œâ”€â”€ begin-with-the-crazy-ideas.textile | â””â”€â”€ on-simplicity-in-technology.markdown â”œâ”€â”€ _includes | â”œâ”€â”€ footer.</description>
    </item>
    
    <item>
      <title></title>
      <link>https://liabio.github.io/post/2019-5-15-kubernetes%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://liabio.github.io/post/2019-5-15-kubernetes%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/</guid>
      <description>kubernetesè‡ªå®šä¹‰èµ„æºå¯¹è±¡é«˜çº§åŠŸèƒ½ kubernetesè‡ªå®šä¹‰èµ„æºå¯¹è±¡å†æå¤§ç¨‹åº¦æé«˜äº†API Serverçš„å¯æ‰©å±•æ€§ï¼Œè®©ä¼ä¸šèƒ½å¤Ÿæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€šè¿‡CRDç¼–å†™controlleræˆ–è€…operatoræ¥å®ç°ç”Ÿäº§ä¸­å„ç§ç‰¹æ®Šåœºæ™¯ã€‚éšç€k8sçš„ç‰ˆæœ¬å‡çº§ï¼ŒCRDçš„åŠŸèƒ½ä¹Ÿè¶Šæ¥è¶Šå®Œå–„ï¼Œä¸‹é¢å¯¹å…¶ä¸­å‡ ç‚¹è¿›è¡Œè¯´æ˜ã€‚
ä»¥ä¸‹éªŒè¯kubernetesç‰ˆæœ¬ä¸º1.13.2ï¼Œdockerç‰ˆæœ¬ï¼š18.09.5
Validationï¼ˆéªŒè¯ï¼‰ åœ¨é¡¹ç›®ä¸­ç”¨è‡ªå®šä¹‰èµ„æºå¯¹è±¡æ—¶ï¼Œå¦‚æœåˆ›å»ºè‡ªå®šä¹‰èµ„æºæ—¶æŸäº›å­—æ®µä¸ç¬¦åˆè¦æ±‚ï¼Œä¼šå¯¼è‡´ç›‘å¬è¯¥èµ„æºå¯¹è±¡çš„controlleræˆ–è€…operatorå‡ºç°å¼‚å¸¸ï¼Œè§£æç»“æ„ä½“æŠ¥é”™ï¼Œæ‰€ä»¥Validationè¿™ä¸ªåŠŸèƒ½éå¸¸å®ç”¨ï¼Œåœ¨åˆ›å»ºæ—¶å°±è¿›è¡Œæ ¡éªŒï¼Œå‡å°‘åé¢çš„æ’é”™å’Œå¼‚å¸¸å¤„ç†çš„éº»çƒ¦ã€‚
å¯ä»¥é€šè¿‡ OpenAPI v3 schemaéªŒè¯è‡ªå®šä¹‰å¯¹è±¡æ˜¯å¦ç¬¦åˆæ ‡å‡† ã€‚æ­¤å¤–ï¼Œä»¥ä¸‹é™åˆ¶é€‚ç”¨äº schemaï¼š
 å­—æ®µdefaultã€nullableã€discriminatorã€readOnlyã€writeOnlyã€xmlã€ deprecated å’Œ $ref ä¸èƒ½è®¾ç½®ã€‚ è¯¥å­—æ®µ uniqueItems ä¸èƒ½è®¾ç½®ä¸º trueã€‚ è¯¥å­—æ®µ additionalProperties ä¸èƒ½è®¾ç½®ä¸º falseã€‚  å¯ä»¥ä½¿ç”¨ kube-apiserverCustomResourceValidation ä¸Šçš„åŠŸèƒ½é—¨ï¼ˆfeature gateï¼‰ç¦ç”¨æ­¤åŠŸèƒ½ï¼š
--feature-gates=CustomResourceValidation=false  ä»ä»¥ä¸‹ç‰¹æ€§é—¨å‚æ•°è¯´æ˜åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ValidationåŠŸèƒ½åœ¨k8s 1.8ç‰ˆæœ¬å°±å·²ç»æœ‰äº†ï¼Œä½†æ˜¯CustomResourceValidationç‰¹æ€§é—¨æ˜¯é»˜è®¤falseï¼Œ1.9Betaä¹‹åç‰ˆæœ¬é»˜è®¤ä¸ºtrue
https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/
ä»¥ä¸‹ç¤ºä¾‹å°†å¤§æ¦‚å¯¹è¯¥åŠŸèƒ½è¿›è¡Œåº”ç”¨å’Œè¯´æ˜ï¼Œåœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒCustomResourceDefinition å¯¹è‡ªå®šä¹‰å¯¹è±¡åº”ç”¨ä»¥ä¸‹éªŒè¯ï¼š
 spec.replicas ä¸ºå¿…å¡«é¡¹ï¼Œç±»å‹ä¸ºintegerï¼Œå€¼ä¸ºå¤§äºç­‰äº0å°äº50çš„å¶æ•°ï¼ˆ2çš„å€æ•°ï¼‰ï¼› spec.repository ä¸ºå¿…å¡«é¡¹ï¼› spec.versionä¸ºå¿…å¡«é¡¹ï¼› spec.pauseä¸ºbooleanç±»å‹ï¼› spec.updateStrategyä¸ºobjectç±»å‹ï¼Œè¯¥objectä¸­æœ‰typeã€pipelineã€assignStrategieså±æ€§ï¼› spec.updateStrategy.typeä¸ºstringç±»å‹ï¼Œè€Œä¸”åªèƒ½ä¸º&amp;rdquo;AssignReceive&amp;rdquo;, &amp;ldquo;AutoReceive&amp;rdquo;ä¸¤ä¸ªæšä¸¾å€¼ï¼› spec.updateStrategy.pipelineä¸ºstringç±»å‹ï¼Œè€Œä¸”ä¸ºæ­£æ•´æ•°çš„å­—ç¬¦ä¸²ï¼Œç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼^([1-9][0-9]*){1,3}$; spec.updateStrategy.assignStrategiesä¸ºarrayç±»å‹ï¼Œå…¶å…ƒç´ ä¸ºobjectç±»å‹ï¼ˆåŒ…å«slotså’ŒfromReplicaså±æ€§ï¼‰ï¼› spec.updateStrategy.assignStrategies.slotsä¸º1-16384çš„æ­£æ•´æ•°ï¼› spec.updateStrategy.assignStrategies.fromReplicasä¸ºå­—ç¬¦ä¸²ï¼Œç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼^[a-z0-9,]{3,}$ï¼Œå³è‡³å°‘åŒ¹é…3ä½a-zæˆ–è€…0-9æˆ–è€…é€—å·çš„å­—ç¬¦ä¸²ï¼› spec.podä¸ºarrayç±»å‹ï¼Œå…¶å…ƒç´ ä¸ºobjectç±»å‹ï¼ˆåŒ…å«configmapã€monitorImageã€initImageã€middlewareImageå­—æ®µï¼‰ï¼› spec.pod.configmapã€spec.pod.monitorImageã€spec.pod.initImage ã€spec.pod.middlewareImageä¸ºstringç±»å‹ï¼›ä¸”ç”¨requiredæŒ‡å®šconfigmapã€initImageã€middlewareImageå­—æ®µä¸ºå¿…å¡«é¡¹ã€‚  å°†ä»¥ä¸‹å†…å®¹ä¿å­˜åˆ° redis-cluster-crd.yamlï¼š
apiVersion: apiextensions.k8s.io/v1beta1 kind: CustomResourceDefinition metadata: name: redisclusters.redis.middleware.hc.cn spec: group: redis.middleware.hc.cn versions: - name: v1alpha1 # Each version can be enabled/disabled by Served flag.</description>
    </item>
    
    <item>
      <title></title>
      <link>https://liabio.github.io/post/2019-5-21-etcd%E6%93%8D%E4%BD%9C/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://liabio.github.io/post/2019-5-21-etcd%E6%93%8D%E4%BD%9C/</guid>
      <description>etcdæ“ä½œ etcdctlå®‰è£… ä¸‹è½½å¹¶è§£å‹äºŒè¿›åˆ¶æ–‡ä»¶
curl -L https://github.com/coreos/etcd/releases/download/v3.3.2/etcd-v3.3.2-linux-amd64.tar.gz -o etcd-v3.3.2-linux-amd64.tar.gz tar zxf etcd-v3.3.2-linux-amd64.tar.gz  è§£å‹åæ˜¯ä¸€äº›æ–‡æ¡£å’Œä¸¤ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶etcdå’Œetcdctlã€‚etcdæ˜¯serverç«¯ï¼Œetcdctlæ˜¯å®¢æˆ·ç«¯ã€‚
å°†è§£å‹åçš„etcdå’Œetcdctlç§»åŠ¨åˆ°$GOPATH/binç›®å½•ä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨etcdå’Œetcdctlå‘½ä»¤
mv etcd-v3.3.2-linux-amd64/etcd* /usr/local/bin/  # è·å–etcdèŠ‚ç‚¹æˆå‘˜åˆ—è¡¨ $ ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key member list -w=json | jq . { &amp;quot;header&amp;quot;: { &amp;quot;cluster_id&amp;quot;: 16127964494473114000, &amp;quot;member_id&amp;quot;: 10756017414160822000, &amp;quot;raft_term&amp;quot;: 3 }, &amp;quot;members&amp;quot;: [ { &amp;quot;ID&amp;quot;: 10756017414160822000, &amp;quot;name&amp;quot;: &amp;quot;master-192.168.1.103&amp;quot;, &amp;quot;peerURLs&amp;quot;: [ &amp;quot;https://192.168.1.103:2380&amp;quot; ], &amp;quot;clientURLs&amp;quot;: [ &amp;quot;https://192.168.1.103:2379&amp;quot; ] } ] } # è·å–æ‰€æœ‰çš„key $ ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/peer.crt --key=/etc/kubernetes/pki/etcd/peer.key get &amp;quot;&amp;quot; --prefix=true -w=json | jq .</description>
    </item>
    
  </channel>
</rss>